model Chat {
  id          String   @id @default(uuid())
  productId   String
  customerId  String
  sellerId    String
  status      ChatStatus @default(OPEN)

  product     Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  customer    User     @relation("CustomerChats", fields: [customerId], references: [id], onDelete: Cascade)
  seller      User     @relation("SellerChats", fields: [sellerId], references: [id], onDelete: Cascade)
  messages    Message[]
  deletedFor String[] @default([])

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@unique([productId, customerId, sellerId])
  @@index([customerId])
  @@index([sellerId])
  @@index([productId])
}

model Message {
  id         String   @id @default(uuid())
  chatId     String
  senderId   String
  content    String?
  readAt     DateTime?
  deletedFor String[] @default([])  // Array of user IDs who deleted this message

  attachments MessageAttachment[]

  chat       Chat     @relation(fields: [chatId], references: [id], onDelete: Cascade)

  createdAt  DateTime @default(now())

  @@index([chatId])
  @@index([readAt])
}

model MessageAttachment {
  id        String   @id @default(uuid())
  messageId String
  fileUrl   String
  fileType  String

  message   Message  @relation(fields: [messageId], references: [id], onDelete: Cascade)
}

enum ChatStatus {
  OPEN
  CLOSED
  BLOCKED
}
